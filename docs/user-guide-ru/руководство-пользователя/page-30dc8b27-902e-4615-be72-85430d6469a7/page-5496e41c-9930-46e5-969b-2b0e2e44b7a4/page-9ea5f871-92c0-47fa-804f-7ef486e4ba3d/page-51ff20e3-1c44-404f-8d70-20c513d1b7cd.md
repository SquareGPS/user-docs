# Топливный датчик

Топливные датчики позволяют отслеживать уровень топлива в автомобильных баках, цистернах и даже в статичных емкостях. Благодаря алгоритмам платформы, отчетам и правилам данные с этих датчиков позволят отследить уровень потребления топлива, заправки и сливы. Правильное использование данных с этих датчиков позволит экономить большие суммы, предотвращая потери топлива и заранее отслеживая проблемные транспортные средства, которые потребляют топлива больше, чем должны, а следовательно, и прибыли от них гораздо меньше, чем ожидается.

Датчики уровня топлива бывают разных типов. В этой статье предлагаем сконцентрироваться именно на работе топлива на платформе, а также настройках топливных датчиков и на что они влияют.

## От чего зависят показания топливных датчиков на платформе

Правильное отображение данных зависит от:

- Датчика уровня топлива – какой он и насколько хорошо способен считывать показания из бака, а также насколько хорошо он взаимодействует с GPS трекером.
- Установки датчика в баке – если у вас нестандартный бак или требуется нестандартная установка, лучше всего посоветоваться с производителем о том, как установить такой датчик.
- Настройки на стороне устройства - необходимо удостовериться, что датчик настроен и устройство отправляет его данные на платформу. Желательно не производить дополнительных калибровок на стороне устройства, а делать это сразу на платформе.
- Настройки на стороне платформы – от них зависят не просто показания в виджетах, но также работа оповещений о сливах и заправках и [в других отчетах](../../../../page-80d111aa-610b-4c01-b2a2-852fd3d0758e/page-c6884ac6-eab2-4d0c-9239-4a81e683fa80.md). Чем точнее вы произведете настройки, тем удобнее будет анализировать показания и выявлять нестандартные случаи, требующие вашего внимания.

## Создание датчика

Топливные датчики – это один из типов [измерительных датчиков](../page-6972034d-3692-46f5-b885-3ae0204eebf2.md). Для создания такого датчика на платформе потребуется перейти в раздел Управление устройствами и открыть панель Датчики и кнопки. Нажмите + и выберите измерительный датчик.

## Настройки топливного датчика

После того, как вы выберете Уровень топлива в качестве типа измерительного датчика, отобразятся дополнительные настройки.  
Все настройки топливного датчика:

- Название датчика – укажите удобное и понятное название для датчика, которое будет отображаться в виджетах, отчетах и правилах.
- Вход – выберите вход, с которого устройство передает данные датчика.
- Ед. измерения – выберите единицы измерения.
- Погрешность – заданный процент для расчета абсолютной ошибки от объема бака. По погрешности вычисляется значение для определения заправок и сливов.
- Пороговые значения для определения "сливов" – используются для определения сливов топлива в отчетах. Так как отчеты можно построить по времени и по пробегу, они имеют два вида
  - По времени – максимально допустимый расход в единиц/час, задаётся в настройках датчика, если не задан - то принимается за 120 единиц/час. Используется, если ось X на графике это время. Устанавливайте значение на несколько процентов больше возможного потребления в нагрузке и/или при подъеме авто по склону.
  - По пробегу – максимально допустимый расход единиц/100км. Используется, если ось Х на графике — это пробег. Необходимо указывать вручную. Использовать то, что указывается заводом производителем авто в качестве потребления на 100 км не рекомендуется. Лучше всего – провести тесты и проверить реальный расход на отчетах, а затем выставить необходимые значения. Так вы добьетесь максимальной точности.
- Игнорировать в движении – платформа будет исключать сливы и заправки для правил и отчетов, которые начались или происходили во время движения. Движение определяется по настройке [Определение стоянок](../../../page-a2054a4a-6741-458f-ba56-5ce38f2b886f/page-69e5e65f-284e-42c9-adaa-ad826792d5ac/page-124f9d50-1531-4d6b-8b13-fb16dde98ce5.md).
  - Сливы – платформа не будет учитывать сливы при движении.
  - Заправки – платформа не будет учитывать заправки в движении.
  - Задержка работы фильтра - настройка появляется при включении игнорирования. Таймаут в минутах, который определяет, насколько будут сокращены интервалы движения для фильтрации заправок на одинаковое количество минут до начала стоянки и после начала поездки. Данная опция может быть полезна если уровень топлива стабилизируется через некоторое время после заправки, когда транспортное средство уже начало движение. Такое возможно в случае больших объемов топливных баков. По умолчанию этот параметр равен 5-ти минутам.
- Калибровочная таблица – параметр для преобразования показаний датчика в необходимые единицы измерения, например в литры. Иногда значения для таблицы могут быть предоставлены производителями датчиков. Но в большинстве ситуаций может потребоваться тарировка.
  - объем бака - максимальный, указанный в калибровочной таблице объем в литрах, либо 100, если тарировка не задана (предполагается, что данные передаются в процентах).
  - Даже если ваш датчик уже присылает данные на платформу в литрах, то лучше указать тарировку в виде 0 = 0 литров и максимальная вместимость топливного бака = X литров.
  - Если это датчик, который передает информацию об уровне топлива в процентах, укажите тарировку 0 = 0 литров и 100 = максимальная вместимость топливного бака литров.
- Расширенные настройки – находятся под калибровочной таблицей. Отвечают за игнорирование каких-либо данных при выводе информации.
  - Игнорировать значения – значения указываются в том виде, в котором они приходят на платформу от устройства.
    - Менее – игнорировать любые значения, меньше Х. Полезно с датчиками, если показания от них постоянно падают ниже определенных значений. Например, неплотно зафиксирован провод или датчик присылает 0 при выключенном зажигании.
    - Более – игнорировать любые значения, больше Х. Полезно с датчиками, показания которых могут резко увеличиваться время от времени. Например, когда они обнаруживают ошибку или большее напряжение, чем должно быть.
  - Коэффициент – умножать получаемые величины на определенный коэффициент. Если необходимо делить значения, используйте десятичную дробь.

## Как работает топливо на платформе

### Получение и обработка

Платформа считывает данные и сохраняет показания датчиков в том виде, в каком они приходят от устройств. Сохранение данных с датчиков происходит только тогда, когда топливный датчик создан в системе.

Применение множителей, фильтрационных минимумов и максимумов, калибровочных таблиц и других настроек датчиков происходит только при выводе данных. Таким образом, у вас всегда есть возможность изменить настройки и построить отчеты заново, чтобы проверить – как изменения повлияли на сохраненные данные.

### Работа сливов и заправок в правилах

В правилах сливы и заправки полностью опираются на калибровочную таблицу и абсолютную ошибку, которая вычисляется из

`объема бака * погрешность`

Берутся последние на текущий момент показания датчика за десять минут и

- Если уровень топлива увеличился больше, чем абсолютная ошибка – зафиксируется событие о заправке.
- Если уровень топлива уменьшился больше, чем абсолютная ошибка – событие о сливе.

Например, если объем бака 100 литров, а погрешность 5%, то изменение уровня топлива на 5 литров в течение 10 минут вызовет срабатывание правила.

Также дополнительные параметры игнорирования заправок и сливов в движении отключают срабатывание правил в движении.

### Работа сливов и заправок в отчетах

В отчетах используется более продвинутая система, так как они опираются на большее количество сохраненных данных. В учет идут все параметры.

Для регистрации сливов платформа использует абсолютную ошибку и скорость снижения уровня топлива.

К сливу относится уменьшение уровня топлива более чем на величину погрешности со скоростью превышающей предельный расход по времени или предельный расход по пробегу(если он задан). Какой из порогов использовать, определяет ось Х на графике.

К заправке в отчете относится увеличение уровня топлива более чем на величину погрешности.

Подряд идущие заправки или сливы группируются. То есть, если одно и то же условие сработало несколько раз подряд, платформа сгруппирует их в одну большую заправку или слив.

### Игнорирование заправок и сливов в движении

Как только вы включили одну или обе опции игнорирования в настройках датчика - для отчетов и оповещений будет использоваться следующий алгоритм в дополнение к стандартным:

- Если заправка начинается [во время стоянки](../../../page-0d033af3-6ba7-4fc3-99e3-a7c6d2a1f6b2/page-70e623e7-0d1c-401c-b014-2cb2ec6837bf/page-7f68407f-a50b-4508-9462-2ca5bda3c44b.md), это будет отображено в отчете и зарегистрировано правилом. Кроме того, если заправка начинается в течение X минут из задержки фильтра до начала стоянки или в течение X минут из задержки фильтра после начала поездки, это также будет зарегистрировано правилом и отображено в отчете.
- Однако, если заправка начинается раньше, чем через X минут из задержки фильтра перед парковкой или позже, чем через X минут из задержки фильтра с начала поездки, она будет отфильтрована.
- В случаях, когда задержка фильтра не указана, все заправки, начинающиеся во время поездок, будут отфильтрованы.